<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="product-title">Product Details</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="https://www.flaticon.com/svg/static/icons/svg/3144/3144456.svg" type="image/x-icon">
</head>
<body>
    <header>
        <a href="/" class="logo">Shopify</a>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Search for products, brands and more">
            <button id="search-btn">Search</button>
        </div>
        <nav>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/views/cart.html">
                    Cart
                    <span id="cart-count">0</span>
                </a>
                <a href="/views/login.html">Login</a>
                <button id="logout-btn" style="display:none;">Logout</button>
            </div>
        </nav>
    </header>

    <main>
        <div id="product-detail-container" class="product-detail-layout">
            <p id="loading-message">Loading product details...</p>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Shopify. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productDetailContainer = document.getElementById('product-detail-container');
            const cartCountSpan = document.getElementById('cart-count');
            const logoutBtn = document.getElementById('logout-btn');
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');

            // Header and Cart Count Logic
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                const loginLink = document.querySelector('a[href="/views/login.html"]');
                if (loginLink) loginLink.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'inline';
            }
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('user');
                    localStorage.removeItem('token');
                    window.location.href = '/';
                });
            }
            function updateCartCount() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cartCountSpan) {
                    cartCountSpan.textContent = cart.length;
                }
            }
            updateCartCount();

            // Search Functionality (Header search bar ke liye)
            if (searchBtn) {
                searchBtn.addEventListener('click', () => {
                    const searchQuery = searchInput.value;
                    window.location.href = `/?search=${encodeURIComponent(searchQuery)}`;
                });
            }

            // Product Detail Logic
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (productId) {
                fetch(`/api/products/${productId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Product not found');
                        }
                        return response.json();
                    })
                    .then(product => {
                        document.getElementById('product-title').textContent = product.name;
                        productDetailContainer.innerHTML = `
                            <div class="product-image-container">
                                <img src="${product.imageUrl}" alt="${product.name}">
                            </div>
                            <div class="product-details-content">
                                <h1>${product.name}</h1>
                                <p class="price">$${product.price.toFixed(2)}</p>
                                <p>${product.description}</p>
                                <button id="add-to-cart-btn" class="add-to-cart-page-btn">Add to Cart</button>
                            </div>
                        `;

                        // Add to Cart button logic for this page
                        document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                            const cart = JSON.parse(localStorage.getItem('cart')) || [];
                            cart.push(product);
                            localStorage.setItem('cart', JSON.stringify(cart));
                            updateCartCount();
                            alert(`${product.name} added to cart!`);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching product details:', error);
                        productDetailContainer.innerHTML = `<p>Error: ${error.message}</p>`;
                    });
            } else {
                productDetailContainer.innerHTML = '<p>Product ID not specified.</p>';
            }
        });
    </script>
</body>
</html>